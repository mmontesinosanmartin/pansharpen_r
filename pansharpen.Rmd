---
title: "Pansharpening satellite images from R"
author: "Manuel Montesino-SanMartin"
date: "09/11/2020"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Tutorial: Pansharpening

The amount of techniques to process satellite imagery can be
overwhelming. This tutorial is an attempt to summarize and organize some
of these techniques. Here, we focus on techniques available in `R`
(either native or through third-party software, such as
[SAGA](http://www.saga-gis.org/en/index.html) or
[GRASS](https://grass.osgeo.org/)). Other methods are also described,
just enough to provide further context and be aware about the pros and
cons of using `R` as a tool to pre-process satellite images.

## Intro

This topic of this tutorial is **pansharpening** , a group of techniques
to increase the spatial and spectral resolution of satellite images by
fusing images with complementary features. The tutorial gives:

-   An introduction to the basics of pansharpening (Section 1)

-   An overview of methods (Section 2)

-   Descriptions of some methods (Section 3), including:

    -   Brief theoretical explanations
    -   Simple and reproducible examples

Minimum requirement to follow this tutorial: install
[`RStoolbox`](http://bleutner.github.io/RStoolbox/)(Leutner et al.,
2019) to pansharpen and `tmap` (Tennekes, 2018) to visualize the
results:

```{r, eval=FALSE}
install.packages("RStoolbox")
install.packages("tmap")
```

## The basics

Pansharpening methods generally fuse a **panchromatic** and a
[**multi-spectral**](https://en.wikipedia.org/wiki/Multispectral_image)
(or hyper-spectral) image:

-   A **panchromatic** (*PAN*) image is an image with greater spatial
    details (*but little spectral information*). Instruments retrieving
    PAN images sense broader bandwidths (visible and to some degree
    near-infrared) to increase the signal-to-noise ratio and capture
    finer spatial details. This also means that panchromatic images have
    a single band and they do not distinguish intensities from discrete
    wavelengths. In this tutorial, we use the *PAN* image under the path
    `./Data/pan` , with a resolution of $15 \times 15m^2$ resolution.

    ```{r}
    library(raster)
    pan.img <- raster("./Data/pan_example.tif")
    pan.img
    plot(pan.img, col = grey.colors(10))
    ```

-   **Multi(hyper)-spectral** (*MS*) images carry information about the
    radiance/reflectance from narrower wavelengths. The difference
    between multi and hyper-spectral lays on the number of bands (tens
    vs. hundreds) and how narrow the bandwidths are. Our multi-spectral
    image has 4 bands; red, green, blue, and near-infrared (*NIR*) and a
    resolution of $30 \times 30 m^2$ resolution. The image can be found
    in `./Data/ms` in this repository:

    ```{r}
    ms.img <- stack("./Data/ms_example.tif")
    ms.img
    plotRGB(ms.img, stretch = "lin")
    ```

*PAN* and *MS* images were captured by
[Landsat-8,](https://es.wikipedia.org/wiki/Landsat_8) on June 30st 2015
and belong to the [Collection
1](https://www.usgs.gov/core-science-systems/nli/landsat/landsat-collection-1?qt-science_support_page_related_con=1#qt-science_support_page_related_con),
Level 1.

## Overview

Pansharpening methods are classified in two main categories (Alparone et
al., 2015):

-   **Component Substitution** (*CS*) methods: These methods project the
    multi-spectral image into a new vector space. The new vector space
    disentangles the spatial structure from the spectral information.
    The component representing the spatial structure is replaced by the
    *PAN* image. Finally, the image is projected back to the original
    vector space. Among the *CS* techniques, some of the most popular
    are the *Intensity-Hue-Saturation* method (*IHS*), the *Principal
    Component Analysis* (*PCA*), and the *Gram-Schmidt* spectral
    sharpening.

-   **Multi-Resolution Analyses** (*MRA*): This group of methods extract
    the spatial structure from the *PAN* image through multi-resolution
    decomposition. The spatial details are then *injected* into an
    interpolated version of the multi-spectral image. The most popular
    are the (decimated) *Discrete Wavelet Transform* (*DWT*),
    *Undecimated Wavelet Transform* (*UDWT*), *A-Trous Wavelet
    Transform* (*ATW*), and the *Laplacian Pyramid* (*LP*).

A third group combines both *CS* and *MRA*, and hence they are called
*hybrid*. Current software in `R` covers some *CS* methods. They provide
a high geometrical quality and they are simple and computationally fast.
However, they do not consider potential discrepancies between the *PAN*
and the *MS* image, leading to spectral distortions in some
circumstances. They should be used with care (or avoided) for the
analysis of spectral signatures (Alparone et al., 2015; Wegmann et al.,
2016).

## Methods

To avoid blurred results, it is a good practice to ensure the proper
corregistration between *PAN* and *MS*, even when collected from the
same platform (Wegmann et al., 2016).

### The Intensity-Hue-Saturation method (IHS)

The classical approach deals only with the Red-Green-Blue spectral bands
(Wegmann et al., 2016). It preserves the color balance relatively well
(Wegmann et al., 2016).

```{r, eval=FALSE}
ihs.img <- panSharpen(ms.img, pan.img, r = 1, g = 2, b = 3, method = "ihs", norm = TRUE)
plotRGB(ihs.img, stretch= "lin")
```

### The Principal Component Analysis

Can lead to severe color distortions (Wegmann et al., 2016) but shows
good capabilities in reproducing sharp edges and can deal with more than
three bands (Wegmann et al., 2016).

## Refrences

Alparone, L., Aiazzi, B., Baronti, S., & Garzelli, A. (2015).
Pansharpening of Multispectral Images, in Remote Sensing Image Fusion.
*Crc Press*.

Leutner B., Horning N., & Schwalb-Willmann, J. (2019). `RStoolbox`:
*Tools for Remote Sensing Data Analysis*. R package version 0.2.6.
<https://CRAN.R-project.org/package=RStoolbox>

Tennekes, M. (2018). `tmap`: Thematic Maps in R. *Journal of Statistical
Software* **84** (6), 1-39. (URL:
[https://doi.org/10.18637/jss.v084.i06).](https://doi.org/10.18637/jss.v084.i06).)

Wegmann, M., Leutner, B., & Dech, S. (Eds.). (2016). Remote sensing and
GIS for ecologists: using open source software. *Pelagic Publishing
Ltd.*
